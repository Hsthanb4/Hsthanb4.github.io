<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>new test | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="简历业务层怎么实现网络层怎么实现有哪些业务功能 内容介绍，技术架构,  遇到的问题（注销后，再登录就卡死了。 ps -u   看下进程号，gdb attach，bt (backtrace bt 查看程序crash堆栈信息)看到两个线程，主线程的recv阻塞， thread 2 子线程的recv也阻塞，改成主线程专门做成发送线程，子线程专门做接收线程） 自我介绍1-3分钟基本情况我叫陈晓航，来自">
<meta property="og:type" content="article">
<meta property="og:title" content="new test">
<meta property="og:url" content="http://example.com/2023/03/01/myself/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="简历业务层怎么实现网络层怎么实现有哪些业务功能 内容介绍，技术架构,  遇到的问题（注销后，再登录就卡死了。 ps -u   看下进程号，gdb attach，bt (backtrace bt 查看程序crash堆栈信息)看到两个线程，主线程的recv阻塞， thread 2 子线程的recv也阻塞，改成主线程专门做成发送线程，子线程专门做接收线程） 自我介绍1-3分钟基本情况我叫陈晓航，来自">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1661246028315-2578a5c5-72e1-460b-9d9f-d16f749bce37.png#averageHue=%231f1e1e&clientId=u665b606d-a194-4&from=paste&height=660&id=ue0b69d99&originHeight=660&originWidth=696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86045&status=done&style=none&taskId=uf9aaf3b2-a8b1-400e-9a49-380153eb9ce&title=&width=696">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263689519-157ef5a8-763f-4aca-b3c2-38fae9d12f38.png#averageHue=%23f3efed&clientId=u725a01cb-e2b1-4&from=paste&height=134&id=u2adc45cb&originHeight=168&originWidth=687&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=127124&status=done&style=none&taskId=ue49f19b8-c1d5-4d59-ad64-8c03bf93f0b&title=&width=549.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1663121755618-1bc95d19-f821-4d93-aa68-90721c064d1e.png#averageHue=%23f6f5f7&clientId=u293de7e4-fce0-4&from=paste&height=644&id=u95b98598&originHeight=644&originWidth=1235&originalType=binary&ratio=1&rotation=0&showTitle=false&size=395897&status=done&style=none&taskId=u35ddab5f-9752-43ed-afa5-933ed3c264b&title=&width=1235">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684550884396-2b71d4a9-365f-4cbb-a8f5-dff05f4a8c4f.png#averageHue=%23f7f9f7&clientId=ub471c684-f394-4&from=paste&height=400&id=ubad25c1d&originHeight=500&originWidth=1015&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=226041&status=done&style=none&taskId=ua59f574e-7f43-40a2-975c-008379f3d39&title=&width=812">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684553458322-745e960b-a701-407c-aca8-7b64f9bd9e8e.png#averageHue=%23f4f4f3&clientId=u8d839256-a8d4-4&from=paste&height=358&id=u06524de8&originHeight=448&originWidth=960&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=227329&status=done&style=none&taskId=u856ad95c-d867-47f8-8f6c-0e7aa06818c&title=&width=768">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684554134818-13c5b4e0-2086-4f2c-89b5-6ed6a386e7c1.png#averageHue=%23a2d8b3&clientId=u8d839256-a8d4-4&from=paste&height=664&id=u90aee8fe&originHeight=830&originWidth=959&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=467603&status=done&style=none&taskId=uc045a056-9b59-4ddc-974a-70c3b14a4fb&title=&width=767.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684554103586-8e7c32c1-ceca-4589-a90d-779760138db3.png#averageHue=%23f9f9f9&clientId=u8d839256-a8d4-4&from=paste&height=211&id=u810a45eb&originHeight=264&originWidth=873&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=66666&status=done&style=none&taskId=u8c097da4-bcdd-4bfc-970f-91a1621d29a&title=&width=698.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684554694402-617c4953-60a4-4099-a15a-9794e2c7318a.png#averageHue=%23e0e2db&clientId=u8d839256-a8d4-4&from=paste&height=84&id=u289ca663&originHeight=105&originWidth=536&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=55129&status=done&style=none&taskId=u69b4b48c-6d76-4516-b11a-c220b092dab&title=&width=428.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555060433-2fd81196-451a-4fbd-898e-d87c118128a8.png#averageHue=%23d6d5d2&clientId=u8d839256-a8d4-4&from=paste&height=34&id=ucf7f1cf1&originHeight=42&originWidth=930&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=37295&status=done&style=none&taskId=u98314058-5b16-402e-ae9a-d4fbe2d5aac&title=&width=744">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555180087-70d03601-654e-4a93-aa74-65bfbe18eda0.png#averageHue=%23fdfdfd&clientId=u8d839256-a8d4-4&from=paste&height=105&id=ud54de653&originHeight=131&originWidth=672&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=51178&status=done&style=none&taskId=u931a198f-c973-42b8-bd82-ed6502edb76&title=&width=537.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555238635-a8d9e46a-1d3c-4101-9a54-16e079979e43.png#averageHue=%23fafafa&clientId=u8d839256-a8d4-4&from=paste&height=81&id=u9838ab47&originHeight=101&originWidth=958&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=55332&status=done&style=none&taskId=u6c7a5fe3-cbac-4264-ad5d-071fdb8b673&title=&width=766.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555208672-d5f405c5-e7da-49c6-896a-6f49024e66c3.png#averageHue=%23e5e6e0&clientId=u8d839256-a8d4-4&from=paste&height=106&id=u245403d9&originHeight=133&originWidth=629&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=73119&status=done&style=none&taskId=u412131b7-4f32-4988-a058-6f43269369c&title=&width=503.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555290283-3cd7d567-4ab6-4e3e-8d01-ce2f35473099.png#averageHue=%23e8e7de&clientId=u8d839256-a8d4-4&from=paste&height=68&id=u279ffabc&originHeight=85&originWidth=602&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=49626&status=done&style=none&taskId=ue1cd4f96-8280-42f9-9935-ba55607100c&title=&width=481.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555331781-7e8db6f8-1c57-41b2-b1a5-41a47a3ecd43.png#averageHue=%23fafaf9&clientId=u8d839256-a8d4-4&from=paste&height=106&id=uf46e3cc0&originHeight=133&originWidth=274&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=26319&status=done&style=none&taskId=ua4fcbd0c-200e-4cf3-a3b2-12ee776054c&title=&width=219.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571199933-82031b0f-842c-4ba7-9447-7200b4785160.png#averageHue=%23e3e4de&clientId=u8d839256-a8d4-4&from=paste&height=66&id=u9ea440fa&originHeight=83&originWidth=1060&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=62546&status=done&style=none&taskId=ue69abce0-40e1-418f-8c12-96008ea84f2&title=&width=848">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571209823-9eaff244-de66-45e0-bfc6-de1b88336fd7.png#averageHue=%23dfe0d9&clientId=u8d839256-a8d4-4&from=paste&height=44&id=uc3c9273d&originHeight=55&originWidth=423&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=26177&status=done&style=none&taskId=u8ea079a1-8219-4e1d-a6ab-8a5048d56ae&title=&width=338.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571303205-28e3dead-ad73-4138-9033-04580f548ed7.png#averageHue=%23fcfbfb&clientId=u8d839256-a8d4-4&from=paste&height=266&id=u4b56b9bf&originHeight=333&originWidth=711&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=120471&status=done&style=none&taskId=u75008a18-a9db-43e3-b3c0-67513e7df9a&title=&width=568.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571372967-b59f8f22-30fd-40bb-8eaa-63a459ea47af.png#averageHue=%23fcfbfb&clientId=u8d839256-a8d4-4&from=paste&height=331&id=ue8a01799&originHeight=414&originWidth=986&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=229732&status=done&style=none&taskId=u9fdf73f0-6c2a-43cd-8c49-39a969dc648&title=&width=788.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1663769544000-9b1207c6-14d9-444d-b8c5-f631fa9b3a77.png#averageHue=%23fefefe&clientId=u5141579d-f0f3-4&from=paste&height=433&id=gltsG&originHeight=339&originWidth=564&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u25741e52-9ec3-40de-8a0a-140c72ffe6f&title=&width=720">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684579692590-d76ee3e6-4186-4c56-82f4-d67d1a60a8ea.png#averageHue=%23f0f0f0&clientId=u8d839256-a8d4-4&from=paste&height=571&id=s0Ca7&originHeight=714&originWidth=793&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=174905&status=done&style=none&taskId=u727efdb9-1d3d-4459-bf81-3b22f309488&title=&width=634.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684573702777-5c8aa6cb-4b03-4f19-aab2-02590000b2f0.png#averageHue=%23f9f9f8&clientId=u8d839256-a8d4-4&from=paste&height=48&id=ud089666e&originHeight=60&originWidth=477&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=24947&status=done&style=none&taskId=u4b0136c0-3169-4f7a-a33c-8ed0de86e2f&title=&width=381.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684579185696-f4ffac2c-9a9d-4461-8994-94aa4fac3a96.png#averageHue=%23cbd5d2&clientId=u8d839256-a8d4-4&from=paste&height=51&id=u14b0ba08&originHeight=64&originWidth=1430&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=90208&status=done&style=none&taskId=ud061e04c-25b7-4972-8b0d-9a80d2e543a&title=&width=1144">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684579644238-272679f5-861f-4be8-bab7-c0c7ad0a42a9.png#averageHue=%23fcfcfb&clientId=u8d839256-a8d4-4&from=paste&height=240&id=u3435ae98&originHeight=300&originWidth=1063&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=180150&status=done&style=none&taskId=ud3acef53-af76-43e9-a0f9-34b785b7c69&title=&width=850.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684580359210-a21fc9c9-f246-4d12-a454-5ce91bd727ee.png#averageHue=%23fcfbfb&clientId=u8d839256-a8d4-4&from=paste&height=424&id=u0bcb9113&originHeight=530&originWidth=858&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=201722&status=done&style=none&taskId=u525542ad-d924-4342-a532-930ef29c962&title=&width=686.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684581318286-e2e78f77-3607-48c4-9f43-33a950e03871.png#averageHue=%23fbfaf9&clientId=u8d839256-a8d4-4&from=paste&height=302&id=u2da6ae18&originHeight=377&originWidth=580&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=144548&status=done&style=none&taskId=ud144c94a-f352-44eb-8923-bc51eba7963&title=&width=464">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684632587195-ba40cb16-5f48-45ca-870b-1138b46d61bd.png#averageHue=%2321201f&clientId=u743e5c96-78a8-4&from=paste&height=94&id=ude8d76a8&originHeight=118&originWidth=537&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=11498&status=done&style=none&taskId=u1e05ab33-8ebb-41bc-b8a1-dc478c7e23d&title=&width=429.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684635968608-4ab45e42-96b9-422f-a164-b205f5526d45.png#averageHue=%23f6f6f5&clientId=u743e5c96-78a8-4&from=paste&height=642&id=wU8sd&originHeight=803&originWidth=1457&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=394188&status=done&style=none&taskId=u7839de06-c18b-4b81-8ba2-07196911b13&title=&width=1165.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637332607-e719d55b-c1e9-478d-a245-691ccc79df0b.png#averageHue=%23f3f3f3&clientId=u743e5c96-78a8-4&from=paste&height=205&id=u2a6f4fb9&originHeight=256&originWidth=993&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=107859&status=done&style=none&taskId=u20526ca2-60ce-44af-8dc5-32db6eb3c9f&title=&width=794.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637420373-ea79556e-1193-4b1e-b5a0-067a534edb4e.png#averageHue=%23f7f6f6&clientId=u743e5c96-78a8-4&from=paste&height=271&id=ua1f7f6a4&originHeight=339&originWidth=852&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=154425&status=done&style=none&taskId=u819d23de-6483-43b8-9ecb-ca467681115&title=&width=681.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637588301-2a87d0fe-60d6-4ad4-9276-b9361bf3cb6a.png#averageHue=%23f4f4f3&clientId=u743e5c96-78a8-4&from=paste&height=420&id=u9ae89fd4&originHeight=525&originWidth=886&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=163738&status=done&style=none&taskId=u0c509ba8-7481-4823-909b-13a75f6fef4&title=&width=708.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637629035-203bab7a-bb9b-4178-90c8-2565e35bacb0.png#averageHue=%23f7f6f6&clientId=u743e5c96-78a8-4&from=paste&height=69&id=u676ebad1&originHeight=86&originWidth=402&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=16792&status=done&style=none&taskId=u7a5b492b-faa4-48b4-b9c7-c18f17b9abe&title=&width=321.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684638782125-51891c0b-5a11-4470-bc91-50714a87188b.png#averageHue=%23f9f9f8&clientId=u743e5c96-78a8-4&from=paste&height=474&id=u20e66bac&originHeight=592&originWidth=953&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=321256&status=done&style=none&taskId=u23aeb4b1-9165-41fb-896f-7c70a75321d&title=&width=762.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1667996304136-352828f8-479b-4690-9b9f-0f85fe4180d6.png#averageHue=%23bdc0c3&clientId=u6afd4a54-5dab-4&from=paste&height=550&id=GH6tm&originHeight=550&originWidth=548&originalType=binary&ratio=1&rotation=0&showTitle=false&size=241673&status=done&style=none&taskId=u8d633258-d068-49d9-abe7-04039c42850&title=&width=548">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1667996561858-f8940407-b1e4-4745-9759-3c0c472a099d.png#averageHue=%23cad0d4&clientId=u6afd4a54-5dab-4&from=paste&height=85&id=L6sh8&originHeight=85&originWidth=455&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25806&status=done&style=none&taskId=uc95f7fe2-2450-4b4d-94b1-30fd6c8a11c&title=&width=455">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1680395994049-85c46c28-f373-4833-ad04-6832d4afcc03.png#averageHue=%23fbfbfb&clientId=u00fc456d-cdce-4&from=paste&height=471&id=zxvrR&originHeight=589&originWidth=1050&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=225190&status=done&style=none&taskId=ua2e124ab-b20e-4007-8f38-22d07824359&title=&width=840">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1680396329618-85fa5113-eb3d-46c1-b165-b43f99e7388f.png#averageHue=%23e6e6e4&clientId=u00fc456d-cdce-4&from=paste&height=48&id=AMo8a&originHeight=60&originWidth=364&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=22362&status=done&style=none&taskId=u1cb358cd-e9ce-4331-959e-6b37f82a47a&title=&width=291.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1668000906829-3c786d16-4633-4a1f-8c9c-91f3473a0623.png#averageHue=%23c3c4c7&clientId=u37ea39a8-4d6a-4&from=paste&height=259&id=oPuIB&originHeight=598&originWidth=1459&originalType=binary&ratio=1&rotation=0&showTitle=false&size=405649&status=done&style=none&taskId=u74d334cc-f7a6-4991-94b0-a292b5cba91&title=&width=633">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1668001095741-b31a2292-7f1d-44a4-a158-72bd026a816a.png#averageHue=%23cdcfd1&clientId=u37ea39a8-4d6a-4&from=paste&height=390&id=t3qes&originHeight=390&originWidth=1219&originalType=binary&ratio=1&rotation=0&showTitle=false&size=275792&status=done&style=none&taskId=ueeff9235-ca07-495b-81ad-f368875aae1&title=&width=1219">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666087053089-7cefa996-2bae-4c13-8987-668a4c24b3ae.png#averageHue=%23fbfafc&clientId=u774e3d07-be0d-4&from=paste&height=108&id=duUPg&originHeight=108&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43807&status=done&style=none&taskId=uf667223c-0648-479d-94a1-d855d490da1&title=&width=779">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666087136239-7b351363-f842-4aa0-a73e-2394dc534544.png#averageHue=%23edeeef&clientId=u774e3d07-be0d-4&from=paste&height=604&id=AQVij&originHeight=604&originWidth=1304&originalType=binary&ratio=1&rotation=0&showTitle=false&size=218044&status=done&style=none&taskId=u3b82d516-0abd-4d33-bd0b-f1a39b182ca&title=&width=1304">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666087754946-90d3c76c-3949-45a4-9f3b-7b66b72ee203.png#averageHue=%23d1e3d8&clientId=u774e3d07-be0d-4&from=paste&height=126&id=kPByl&originHeight=126&originWidth=712&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85841&status=done&style=none&taskId=ua411e92b-44ea-4fa5-9a2a-72ebaa660b9&title=&width=712">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666094132325-973d6231-bf08-4643-93ec-09eb303e3bd1.png#averageHue=%23c2c1ce&clientId=u774e3d07-be0d-4&from=paste&height=415&id=GvNGl&originHeight=415&originWidth=1009&originalType=binary&ratio=1&rotation=0&showTitle=false&size=235875&status=done&style=none&taskId=u10794402-18ac-4e7c-b248-bdc4c86fa44&title=&width=1009">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1667213649146-002406e4-d67b-4ad3-852e-54a61ca65767.png#averageHue=%23c8c7cb&clientId=u650d49d6-870b-4&from=paste&height=893&id=BeT56&originHeight=893&originWidth=944&originalType=binary&ratio=1&rotation=0&showTitle=false&size=452212&status=done&style=none&taskId=u4b8f1fa2-0d09-42bd-b2eb-c41b0152e5e&title=&width=944">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1680537354689-a36c34ee-81f6-4e29-bc29-76d4f2e2c292.png#averageHue=%23f9f8f8&clientId=u1a441170-8b1c-4&from=paste&height=506&id=fMGqs&originHeight=632&originWidth=992&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=192746&status=done&style=none&taskId=u31d66448-421d-45d7-a6bb-1bf805f4de6&title=&width=793.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097651849-2922dffc-c933-49b9-a491-8b51f43dfd0f.png#averageHue=%23efefef&clientId=u4da48238-fa3e-4&from=paste&height=83&id=uecfbd4f7&originHeight=104&originWidth=1283&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=99626&status=done&style=none&taskId=u4f9c9989-be4a-4019-8218-64029530c66&title=&width=1026.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097635561-fd67a721-7069-4de2-b0f2-62bda97d47f7.png#averageHue=%23f0f0f0&clientId=u4da48238-fa3e-4&from=paste&height=148&id=u5ae0781e&originHeight=185&originWidth=353&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=27986&status=done&style=none&taskId=u981c98d5-df48-4e26-8778-a22442d117f&title=&width=282.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097686742-94628300-2327-47cb-8eb8-3b2ce903bf5f.png#averageHue=%23efefef&clientId=u4da48238-fa3e-4&from=paste&height=268&id=u2e077a3b&originHeight=335&originWidth=867&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=140539&status=done&style=none&taskId=u6024ec15-66d3-4da3-8bdb-b1f1424fab9&title=&width=693.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097885092-7c94bc56-8a51-482b-8845-efbabef7538e.png#averageHue=%23f6f5f5&clientId=u4da48238-fa3e-4&from=paste&height=558&id=u1c45ddc9&originHeight=698&originWidth=1501&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=354888&status=done&style=none&taskId=ua9041be0-11ef-49db-943a-afa383ae4bd&title=&width=1200.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681098102032-a344042a-dfa1-4d7e-b593-3dc94cbb5219.png#averageHue=%23fefcfa&clientId=u4da48238-fa3e-4&from=paste&height=414&id=uac273fde&originHeight=517&originWidth=756&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=149425&status=done&style=none&taskId=u22309f7f-936f-41e2-bd58-aab3ccd5f54&title=&width=604.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681559706051-aa278808-9021-4d0a-b913-566350fb9ce3.png#averageHue=%23f1f1f1&clientId=u91a51984-9120-4&from=paste&height=172&id=ubb1f9517&originHeight=215&originWidth=755&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=97276&status=done&style=none&taskId=u29d22332-2d6e-4ce5-8e4d-51d2a1b514e&title=&width=604">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681559852030-37307770-622f-4f60-82ef-1c83e2bca8f2.png#averageHue=%23fdfaf9&clientId=u91a51984-9120-4&from=paste&height=358&id=u8579d2ae&originHeight=447&originWidth=934&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=200279&status=done&style=none&taskId=u865d38b8-2e4c-4761-b7aa-bbb5deb23bd&title=&width=747.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681559706051-aa278808-9021-4d0a-b913-566350fb9ce3.png#averageHue=%23f1f1f1&clientId=u91a51984-9120-4&from=paste&height=172&id=AD822&originHeight=215&originWidth=755&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=97276&status=done&style=none&taskId=u29d22332-2d6e-4ce5-8e4d-51d2a1b514e&title=&width=604">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681600904035-4f764e43-63ce-4347-b676-83072035c8c2.png#averageHue=%23f4f4f3&clientId=u0bde6753-97ab-4&from=paste&height=413&id=u0a9c380a&originHeight=516&originWidth=1301&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=432864&status=done&style=none&taskId=ue61555bf-7aab-4023-a341-dd2550f4c55&title=&width=1040.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681601196539-8285e516-c4bc-4126-bf4c-076ec3eea316.png#averageHue=%23f6f6f6&clientId=u246fa6d8-4e1a-4&from=paste&height=246&id=qR0AW&originHeight=307&originWidth=376&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=49656&status=done&style=none&taskId=u53a41dc0-d33b-435a-9722-70fef626286&title=&width=300.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681601747146-33ff2638-fa09-4c5d-b526-9cd765800681.png#averageHue=%23fcf8f8&clientId=u246fa6d8-4e1a-4&from=paste&height=223&id=u33d24ffa&originHeight=279&originWidth=744&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=90496&status=done&style=none&taskId=u1514bf98-9951-4f59-a426-58897884e15&title=&width=595.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681288922419-40e9f437-363e-4c73-bc4b-cd2009e4f069.png#averageHue=%23f2efec&clientId=u01941d70-3b3c-4&from=paste&height=267&id=u32a88770&originHeight=334&originWidth=652&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=130830&status=done&style=none&taskId=ud32ad7c6-e9f2-4850-8504-4d599c9e57b&title=&width=521.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681611763077-3f64a0ea-c82e-48e5-8c45-d8ee5c3b3293.png#averageHue=%23273623&clientId=u246fa6d8-4e1a-4&from=paste&height=129&id=ue4e9217b&originHeight=161&originWidth=579&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=110291&status=done&style=none&taskId=u13d14352-a72c-4439-ad91-7f0f6cdd813&title=&width=463.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681611927195-ae2feb8f-58b3-4f18-ae42-9f730249a314.png#averageHue=%2324291d&clientId=u246fa6d8-4e1a-4&from=paste&height=79&id=ubf990406&originHeight=99&originWidth=1003&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=88017&status=done&style=none&taskId=ud685380b-0e24-40e2-9a73-c7dca924580&title=&width=802.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681612026587-b9d76479-9c49-4518-bcf8-1fec9ea05865.png#averageHue=%23312f28&clientId=u246fa6d8-4e1a-4&from=paste&height=422&id=u49f5e059&originHeight=528&originWidth=717&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=188098&status=done&style=none&taskId=ufbb39091-3497-4c80-adc4-5a67aec1d04&title=&width=573.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681612192601-4cdcd9ff-80f4-4211-9874-cb3799294b80.png#averageHue=%2331332a&clientId=u246fa6d8-4e1a-4&from=paste&height=241&id=u0a64c93a&originHeight=301&originWidth=665&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=153374&status=done&style=none&taskId=u111c1694-cc47-4a40-96c7-2f07a2892c4&title=&width=532">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681467469722-43e8fe54-04ba-47cc-9d3e-f5e16cc4dcfe.png#averageHue=%23878480&clientId=ud78e10a6-887f-4&from=paste&height=630&id=u20ba9965&originHeight=787&originWidth=1515&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=705908&status=done&style=none&taskId=uab0babe6-92bb-4d55-82b8-54cb7f33c22&title=&width=1212">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681469423985-c5af2eb9-61fd-449f-98c6-2d2b0898798d.png#averageHue=%233b4336&clientId=u84c80d1a-d421-4&from=paste&height=261&id=u9823dab5&originHeight=326&originWidth=926&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=243533&status=done&style=none&taskId=u35073638-74e7-43fe-b570-5b9669bf38c&title=&width=740.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681469460963-ff95181f-ce4a-4fb4-9286-b1f1390414a3.png#averageHue=%2321201f&clientId=u84c80d1a-d421-4&from=paste&height=60&id=u76eed82c&originHeight=75&originWidth=459&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=9020&status=done&style=none&taskId=u70909f67-799e-4b04-8a1d-3f5c38f327f&title=&width=367.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681551982504-3500d18c-d127-4b2e-acb6-36c3085b7a4d.png#averageHue=%23333028&clientId=uea553347-230e-4&from=paste&height=151&id=u5d163111&originHeight=189&originWidth=838&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=109510&status=done&style=none&taskId=ucc02137e-087f-4790-ba84-59da482c892&title=&width=670.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550753982-968910c9-a429-47ef-86b9-cddd7dc7be0a.png#averageHue=%23323b3e&clientId=uea553347-230e-4&from=paste&height=37&id=u8a199c9b&originHeight=46&originWidth=525&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=30969&status=done&style=none&taskId=u476b4cdc-f611-4ce6-97a8-29a0197f2af&title=&width=420">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550791890-63b48c55-7d0e-49e8-9236-d5d7fdc71755.png#averageHue=%232e363a&clientId=uea553347-230e-4&from=paste&height=30&id=u06a96bd0&originHeight=37&originWidth=196&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=6206&status=done&style=none&taskId=u51d7106b-13bc-4c0a-b0b1-27792a34022&title=&width=156.8">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550904337-16167249-a262-45e7-8f90-1758795c88f5.png#averageHue=%232f363a&clientId=uea553347-230e-4&from=paste&height=414&id=ue577903d&originHeight=517&originWidth=1193&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=484573&status=done&style=none&taskId=u9c28adf8-54c5-4718-b1dc-a4624ce7b90&title=&width=954.4">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550942858-018d786e-5399-4119-a9c6-707933f1c415.png#averageHue=%23323c3f&clientId=uea553347-230e-4&from=paste&height=133&id=u483e1a85&originHeight=166&originWidth=527&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=83836&status=done&style=none&taskId=u8bfb5da2-c9f1-4387-9d51-f415fb7ef62&title=&width=421.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263327874-2b3ef803-6699-4f03-b275-fa9031254cdb.png#averageHue=%23ece9e7&clientId=u725a01cb-e2b1-4&from=paste&height=129&id=uff42c514&originHeight=161&originWidth=882&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=36216&status=done&style=none&taskId=u3be6c792-6cd3-4f27-8bfb-93d6869b992&title=&width=705.6">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263641578-1f2f8cdb-7835-4dd7-bd39-67ab48bfe905.png#averageHue=%23f8f7f6&clientId=u725a01cb-e2b1-4&from=paste&height=240&id=u752034a1&originHeight=300&originWidth=964&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=145945&status=done&style=none&taskId=u4e74f7b7-7b25-424f-974f-e05d1cf8d5e&title=&width=771.2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263626853-cd89773c-c5cc-4d78-81ce-07ced18121c8.png#averageHue=%23f0f5e4&clientId=u725a01cb-e2b1-4&from=paste&height=303&id=u36759d41&originHeight=379&originWidth=893&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=76713&status=done&style=none&taskId=u00e81ab5-300d-4fc0-b928-da07dbcb09e&title=&width=714.4">
<meta property="article:published_time" content="2023-03-01T12:38:05.000Z">
<meta property="article:modified_time" content="2023-06-01T14:15:55.033Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/png/29443453/1661246028315-2578a5c5-72e1-460b-9d9f-d16f749bce37.png#averageHue=%231f1e1e&clientId=u665b606d-a194-4&from=paste&height=660&id=ue0b69d99&originHeight=660&originWidth=696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86045&status=done&style=none&taskId=uf9aaf3b2-a8b1-400e-9a49-380153eb9ce&title=&width=696">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-myself" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/01/myself/" class="article-date">
  <time class="dt-published" datetime="2023-03-01T12:38:05.000Z" itemprop="datePublished">2023-03-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      new test
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1661246028315-2578a5c5-72e1-460b-9d9f-d16f749bce37.png#averageHue=%231f1e1e&clientId=u665b606d-a194-4&from=paste&height=660&id=ue0b69d99&originHeight=660&originWidth=696&originalType=binary&ratio=1&rotation=0&showTitle=false&size=86045&status=done&style=none&taskId=uf9aaf3b2-a8b1-400e-9a49-380153eb9ce&title=&width=696" alt="image.png"></p>
<hr>
<h2 id="简历"><a href="#简历" class="headerlink" title="简历"></a>简历</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263689519-157ef5a8-763f-4aca-b3c2-38fae9d12f38.png#averageHue=%23f3efed&clientId=u725a01cb-e2b1-4&from=paste&height=134&id=u2adc45cb&originHeight=168&originWidth=687&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=127124&status=done&style=none&taskId=ue49f19b8-c1d5-4d59-ad64-8c03bf93f0b&title=&width=549.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1663121755618-1bc95d19-f821-4d93-aa68-90721c064d1e.png#averageHue=%23f6f5f7&clientId=u293de7e4-fce0-4&from=paste&height=644&id=u95b98598&originHeight=644&originWidth=1235&originalType=binary&ratio=1&rotation=0&showTitle=false&size=395897&status=done&style=none&taskId=u35ddab5f-9752-43ed-afa5-933ed3c264b&title=&width=1235" alt="image.png"><br>业务层怎么实现<br>网络层怎么实现<br>有哪些业务功能</p>
<p>内容介绍，技术架构,  遇到的问题（注销后，再登录就卡死了。 ps -u   看下进程号，gdb attach，bt (backtrace bt 查看程序crash堆栈信息)<br>看到两个线程，主线程的recv阻塞， thread 2 子线程的recv也阻塞，改成主线程专门做成发送线程，子线程专门做接收线程）</p>
<h2 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h2><p>1-3分钟<br><strong>基本情况</strong><br>我叫陈晓航，来自四川达州，本科毕业于吉林大学，现在是电子科技大学电子信息计算机技术方向研二的学生，目前在网络空间安全实验室做一些网络安全相关的项目。</p>
<p><strong>学习经历</strong><br>我有主动学习的意识，在本科和研究生期间多次获得学业奖学金。看过一些经典的计算机书籍csapp, c++primer plus.遇到问题比较喜欢上知乎和stackoverflow讨论，也经常会逛一逛github。因此熟悉操作系统，计算机网络相关的知识，对Mysql和redis也有一定的了解。</p>
<p><strong>项目经历</strong><br>方面，完成了一个聊天服务器的开发。<br>整个项目主要分为四个模块，网络层，服务层，数据存储层，负载均衡层。<br>网络层使用了muduo网络库来解耦网络模块和业务模块。<br>服务层用了c++11的技术比如绑定器，实现了消息id和对应操作的绑定。<br>数据存储层使用了mysql对用户信息进行存储。<br>负载均衡层为了提升并发能力，支持多机扩展，搭建了基于nginx的tcp长连接的负载均衡。<br>为了不同服务器上的用户实现跨服务器通信还使用了redis的消息队列功能。</p>
<p><strong>未来规划</strong><br>如果能够有幸进入实习岗位，我会积极提升自我，主动协助同事主动承担任务。<br>我的自我介绍结束了谢谢。</p>
<h1 id="集群聊天项目"><a href="#集群聊天项目" class="headerlink" title="集群聊天项目"></a>集群聊天项目</h1><h2 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h2><p>网络服务器的项目分为四个模块<br>网络模块  muduo开源网络库， 解耦网络模块和业务模块<br>服务层   用了c++11的技术  绑定器 消息id 和对应操作的绑定 ， io 发出消息请求 从中解析出json得到消息id 通过回调处理消息。<br>数据存储层 用了mysql 对用户账号 离线消息 群组列表 等进行存储<br>负载均衡层 提升并发能力，支持多机扩展，支持 ngix负载均衡， 基于tcp私有协议搭建c&#x2F;s通信基于ngix tcp负载均衡，消息聊天通信 客户端不仅要主动给服务端发消息，服务器还得主动给客户端推送消息，因此采用长连接。不同服务器上注册的用户通信使用redis实现消息队列从而实现跨服务器通信。</p>
<h2 id="业务逻辑"><a href="#业务逻辑" class="headerlink" title="业务逻辑"></a>业务逻辑</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684550884396-2b71d4a9-365f-4cbb-a8f5-dff05f4a8c4f.png#averageHue=%23f7f9f7&clientId=ub471c684-f394-4&from=paste&height=400&id=ubad25c1d&originHeight=500&originWidth=1015&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=226041&status=done&style=none&taskId=ua59f574e-7f43-40a2-975c-008379f3d39&title=&width=812" alt="image.png"></p>
<h3 id="1-json"><a href="#1-json" class="headerlink" title="1.json"></a>1.json</h3><p>通过json格式传输压缩数据，使用键值对的方式形成json格式 通过.dump方法序列化成字符串，接收端再使用parse方法解析成json数据对象<br>待办： 查看源码</p>
<h3 id="2-muduo"><a href="#2-muduo" class="headerlink" title="2.muduo"></a>2.muduo</h3><p>网络库epoll+线程池，多reactor多线程模型<br>mainreactor负责处理接收事件然后将收到的消息发给subreactor<br>待办：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xp178171640/article/details/106008183#:~:text=%E8%AE%A2%E9%98%85%E4%B8%93%E6%A0%8F%20muduo%20%E4%B8%AD%EF%BC%8C%20one%20loop%20per%20thread,%E5%8D%B3%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E4%B8%AD%E4%B8%80%E4%B8%AAloop%E5%BE%AA%E7%8E%AF%E3%80%82%20%E8%BF%99%E4%B8%AA%E7%BA%BF%E7%A8%8B%E6%98%AF%20EventLoopThread%20%E5%AF%B9%E8%B1%A1%2C%20%E8%BF%99%E4%B8%AA%E5%BE%AA%E7%8E%AF%E5%B0%B1%E6%98%AF%E5%85%B6%E6%88%90%E5%91%98%20EventLoop%20%E5%AF%B9%E8%B1%A1%E8%B0%83%E7%94%A8%E7%9A%84loop%20%28%29%E5%BE%AA%E7%8E%AF%EF%BC%8C%E7%94%B1%E8%BF%99%E4%B8%AA%E5%BE%AA%E7%8E%AF%E6%9D%A5%E8%BF%9B%E8%A1%8C%E7%AD%89%E5%BE%85%E4%BA%8B%E4%BB%B6%E5%B0%B1%E7%BB%AA%E5%B9%B6%E5%88%86%E5%8F%91%E5%88%B0%E5%90%84%E8%87%AA%E7%9A%84%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E5%87%BD%E6%95%B0%E3%80%82">one loop per thread_xupeng1644的博客-CSDN博客</a><br>待办：默写一遍echo server<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684553458322-745e960b-a701-407c-aca8-7b64f9bd9e8e.png#averageHue=%23f4f4f3&clientId=u8d839256-a8d4-4&from=paste&height=358&id=u06524de8&originHeight=448&originWidth=960&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=227329&status=done&style=none&taskId=u856ad95c-d867-47f8-8f6c-0e7aa06818c&title=&width=768" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684554134818-13c5b4e0-2086-4f2c-89b5-6ed6a386e7c1.png#averageHue=%23a2d8b3&clientId=u8d839256-a8d4-4&from=paste&height=664&id=u90aee8fe&originHeight=830&originWidth=959&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=467603&status=done&style=none&taskId=uc045a056-9b59-4ddc-974a-70c3b14a4fb&title=&width=767.2" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684554103586-8e7c32c1-ceca-4589-a90d-779760138db3.png#averageHue=%23f9f9f9&clientId=u8d839256-a8d4-4&from=paste&height=211&id=u810a45eb&originHeight=264&originWidth=873&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=66666&status=done&style=none&taskId=u8c097da4-bcdd-4bfc-970f-91a1621d29a&title=&width=698.4" alt="image.png"><br>muduo提供了两个类，tcpserver和tcpclient<br>网络库监听和暴露：用户的连接和断开，用户的可读写事件<br>使用：<br>1.组合Tcpserver对象  muduo&#x2F;net&#x2F;tcpserver  需要（<img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684554694402-617c4953-60a4-4099-a15a-9794e2c7318a.png#averageHue=%23e0e2db&clientId=u8d839256-a8d4-4&from=paste&height=84&id=u289ca663&originHeight=105&originWidth=536&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=55129&status=done&style=none&taskId=u69b4b48c-6d76-4516-b11a-c220b092dab&title=&width=428.8" alt="image.png">）<br>2.创建eventloop事件循环对象的指针<br>3.明确tcpserver的构造函数<br>4.注册用户连接和断开的回调，注册用户读写事件回调（为什么要回调，不知道事件什么时候发生，	<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555060433-2fd81196-451a-4fbd-898e-d87c118128a8.png#averageHue=%23d6d5d2&clientId=u8d839256-a8d4-4&from=paste&height=34&id=ucf7f1cf1&originHeight=42&originWidth=930&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=37295&status=done&style=none&taskId=u98314058-5b16-402e-ae9a-d4fbe2d5aac&title=&width=744" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555180087-70d03601-654e-4a93-aa74-65bfbe18eda0.png#averageHue=%23fdfdfd&clientId=u8d839256-a8d4-4&from=paste&height=105&id=ud54de653&originHeight=131&originWidth=672&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=51178&status=done&style=none&taskId=u931a198f-c973-42b8-bd82-ed6502edb76&title=&width=537.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555238635-a8d9e46a-1d3c-4101-9a54-16e079979e43.png#averageHue=%23fafafa&clientId=u8d839256-a8d4-4&from=paste&height=81&id=u9838ab47&originHeight=101&originWidth=958&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=55332&status=done&style=none&taskId=u6c7a5fe3-cbac-4264-ad5d-071fdb8b673&title=&width=766.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555208672-d5f405c5-e7da-49c6-896a-6f49024e66c3.png#averageHue=%23e5e6e0&clientId=u8d839256-a8d4-4&from=paste&height=106&id=u245403d9&originHeight=133&originWidth=629&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=73119&status=done&style=none&taskId=u412131b7-4f32-4988-a058-6f43269369c&title=&width=503.2" alt="image.png"><br>5.设置线程数量<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555290283-3cd7d567-4ab6-4e3e-8d01-ce2f35473099.png#averageHue=%23e8e7de&clientId=u8d839256-a8d4-4&from=paste&height=68&id=u279ffabc&originHeight=85&originWidth=602&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=49626&status=done&style=none&taskId=ue1cd4f96-8280-42f9-9935-ba55607100c&title=&width=481.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684555331781-7e8db6f8-1c57-41b2-b1a5-41a47a3ecd43.png#averageHue=%23fafaf9&clientId=u8d839256-a8d4-4&from=paste&height=106&id=uf46e3cc0&originHeight=133&originWidth=274&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=26319&status=done&style=none&taskId=ua4fcbd0c-200e-4cf3-a3b2-12ee776054c&title=&width=219.2" alt="image.png"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>6.服务类chatservice采用了单例模式<br>public中注册了消息号Enum<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571199933-82031b0f-842c-4ba7-9447-7200b4785160.png#averageHue=%23e3e4de&clientId=u8d839256-a8d4-4&from=paste&height=66&id=u9ea440fa&originHeight=83&originWidth=1060&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=62546&status=done&style=none&taskId=ue69abce0-40e1-418f-8c12-96008ea84f2&title=&width=848" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571209823-9eaff244-de66-45e0-bfc6-de1b88336fd7.png#averageHue=%23dfe0d9&clientId=u8d839256-a8d4-4&from=paste&height=44&id=uc3c9273d&originHeight=55&originWidth=423&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=26177&status=done&style=none&taskId=u8ea079a1-8219-4e1d-a6ab-8a5048d56ae&title=&width=338.4" alt="image.png"><br>该类实现 消息id和对应回调的绑定，以及回调的实现<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571303205-28e3dead-ad73-4138-9033-04580f548ed7.png#averageHue=%23fcfbfb&clientId=u8d839256-a8d4-4&from=paste&height=266&id=u4b56b9bf&originHeight=333&originWidth=711&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=120471&status=done&style=none&taskId=u75008a18-a9db-43e3-b3c0-67513e7df9a&title=&width=568.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684571372967-b59f8f22-30fd-40bb-8eaa-63a459ea47af.png#averageHue=%23fcfbfb&clientId=u8d839256-a8d4-4&from=paste&height=331&id=ue8a01799&originHeight=414&originWidth=986&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=229732&status=done&style=none&taskId=u9fdf73f0-6c2a-43cd-8c49-39a969dc648&title=&width=788.8" alt="image.png"><br>telnet 127.0.0.1 :6000<br>输入 json格式的字符串<br>解析后调用charservice的对应函数</p>
<h3 id="3-数据库"><a href="#3-数据库" class="headerlink" title="3.数据库"></a>3.数据库</h3><p>数据库通过封装一个Mysql数据库操作类实现 实现user usermodel等数据对象</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1663769544000-9b1207c6-14d9-444d-b8c5-f631fa9b3a77.png#averageHue=%23fefefe&clientId=u5141579d-f0f3-4&from=paste&height=433&id=gltsG&originHeight=339&originWidth=564&originalType=url&ratio=1&rotation=0&showTitle=false&status=done&style=none&taskId=u25741e52-9ec3-40de-8a0a-140c72ffe6f&title=&width=720"></p>
<ul>
<li><p>user</p>
<ul>
<li>匹配user表的orm类<blockquote>
<ul>
<li>ORM(Object Relational Mapping)吸收了面向对象的思想，把对 sql 的操作转换为对象的操作，从而让程序员使用起来更加方便和易于接受。这种转换是通过对象和表之间的元数据映射实现的，这是实现 ORM 的关键</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p>group</p>
<ul>
<li>id</li>
<li>name</li>
<li>description</li>
<li>返回用户的容器</li>
</ul>
</li>
<li><p>groupuser</p>
<ul>
<li>setrole</li>
<li>getrole</li>
</ul>
</li>
<li><p>usermodel</p>
<ul>
<li>user表插入</li>
<li>根据用户号码查询用户信息</li>
<li>更新用户状态</li>
<li>重置用户状态</li>
</ul>
</li>
<li><p>friendmodel</p>
<ul>
<li>添加好友关系</li>
<li>返回用户好友列表</li>
</ul>
</li>
<li><p>groupmodel</p>
<ul>
<li>创建群组</li>
<li>加入群组</li>
<li>查询用户所在群组信息</li>
<li>给群组其他成员群发消息</li>
</ul>
</li>
<li><p>offlinemessagemodel</p>
<ul>
<li>存储用户离线消息</li>
<li>删除用户离线消息</li>
<li>查询用户离线消息</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684579692590-d76ee3e6-4186-4c56-82f4-d67d1a60a8ea.png#averageHue=%23f0f0f0&clientId=u8d839256-a8d4-4&from=paste&height=571&id=s0Ca7&originHeight=714&originWidth=793&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=174905&status=done&style=none&taskId=u727efdb9-1d3d-4459-bf81-3b22f309488&title=&width=634.4" alt="image.png"><br>数量1w级</p>
<h3 id="4-业务实现："><a href="#4-业务实现：" class="headerlink" title="4.业务实现："></a>4.业务实现：</h3><h4 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h4><p>接收name,password生成user对象插入</p>
<h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><p>存储在线用户的连接(方便后续服务器主动推送消息）<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684573702777-5c8aa6cb-4b03-4f19-aab2-02590000b2f0.png#averageHue=%23f9f9f8&clientId=u8d839256-a8d4-4&from=paste&height=48&id=ud089666e&originHeight=60&originWidth=477&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=24947&status=done&style=none&taskId=u4b0136c0-3169-4f7a-a33c-8ed0de86e2f&title=&width=381.6" alt="image.png">需要考虑多线程问题mutex<br>查询是否有离线消息，如果有服务器send<br>查询好友信息，返回id name state</p>
<h4 id="异常退出"><a href="#异常退出" class="headerlink" title="异常退出"></a>异常退出</h4><p>删除userconnmap中对应项，update 对应id的user的state</p>
<h4 id="异常重置"><a href="#异常重置" class="headerlink" title="异常重置"></a>异常重置</h4><p>把online设置成offline, main函数中设置resthandler</p>
<h4 id="一对一聊天"><a href="#一对一聊天" class="headerlink" title="一对一聊天"></a>一对一聊天</h4><p>toid  根据id在userconnmap中找到 conn,服务器主动推送消息给toid用户<br>或者没在本服务器查询toid是否在线，如果在线_redis.publish<br>如果没在线，offlinemsgmodel.insert()插入离线消息表</p>
<h4 id="添加好友"><a href="#添加好友" class="headerlink" title="添加好友"></a>添加好友</h4><p>根据userid和friendid操作friendmodel<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684579185696-f4ffac2c-9a9d-4461-8994-94aa4fac3a96.png#averageHue=%23cbd5d2&clientId=u8d839256-a8d4-4&from=paste&height=51&id=u14b0ba08&originHeight=64&originWidth=1430&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=90208&status=done&style=none&taskId=ud061e04c-25b7-4972-8b0d-9a80d2e543a&title=&width=1144" alt="image.png"></p>
<h4 id="群组功能"><a href="#群组功能" class="headerlink" title="群组功能"></a>群组功能</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684579644238-272679f5-861f-4be8-bab7-c0c7ad0a42a9.png#averageHue=%23fcfcfb&clientId=u8d839256-a8d4-4&from=paste&height=240&id=u3435ae98&originHeight=300&originWidth=1063&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=180150&status=done&style=none&taskId=ud3acef53-af76-43e9-a0f9-34b785b7c69&title=&width=850.4" alt="image.png"></p>
<h4 id="群聊天业务"><a href="#群聊天业务" class="headerlink" title="群聊天业务"></a>群聊天业务</h4><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684580359210-a21fc9c9-f246-4d12-a454-5ce91bd727ee.png#averageHue=%23fcfbfb&clientId=u8d839256-a8d4-4&from=paste&height=424&id=u0bcb9113&originHeight=530&originWidth=858&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=201722&status=done&style=none&taskId=u525542ad-d924-4342-a532-930ef29c962&title=&width=686.4" alt="image.png"><br>给每一个用户发送消息</p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p>主线程：<br>socket connect<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684581318286-e2e78f77-3607-48c4-9f43-33a950e03871.png#averageHue=%23fbfaf9&clientId=u8d839256-a8d4-4&from=paste&height=302&id=u2da6ae18&originHeight=377&originWidth=580&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=144548&status=done&style=none&taskId=ud144c94a-f352-44eb-8923-bc51eba7963&title=&width=464" alt="image.png"><br>创建读线程，detach<br>进入主循环<br>1登录，给服务器发送命令，等待子线程接收响应设置登录状态，进入菜单	<br>菜单help()   getline，调用对应回调函数（组装消息后send)<br>2发送注册消息，等待子线程接收注册响应消息<br>3close(fd) 销毁信号量  exit(0)<br>子线程：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684632587195-ba40cb16-5f48-45ca-870b-1138b46d61bd.png#averageHue=%2321201f&clientId=u743e5c96-78a8-4&from=paste&height=94&id=ude8d76a8&originHeight=118&originWidth=537&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=11498&status=done&style=none&taskId=u1e05ab33-8ebb-41bc-b8a1-dc478c7e23d&title=&width=429.6" alt="image.png"><br>循环阻塞recv<br>将收到的数据反序列化生成json对象<br>根据消息类型做对应响应<br>1.打印用户消息<br>2.打印群组消息<br>3.处理登录响应，通知主线程<br>4.处理注册响应，通知主线程</p>
<h3 id="5-负载均衡"><a href="#5-负载均衡" class="headerlink" title="5.负载均衡"></a>5.负载均衡</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684635968608-4ab45e42-96b9-422f-a164-b205f5526d45.png#averageHue=%23f6f6f5&clientId=u743e5c96-78a8-4&from=paste&height=642&id=wU8sd&originHeight=803&originWidth=1457&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=394188&status=done&style=none&taskId=u7839de06-c18b-4b81-8ba2-07196911b13&title=&width=1165.6" alt="image.png"><br>多个服务器运行chatserver,<br>客户端默认连接负载均衡器<br>可以lvs加上多个负载均衡器可以到10w</p>
<p>1.客户端请求，服务器响应都经过负载均衡器  或者服务器建立ip隧道直接响应<br>2.负载均衡器负责跟服务器发送心跳包，回应就-1，没有有+1,超限则故障<br>3.平滑配置，怎么配置的？<img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637332607-e719d55b-c1e9-478d-a245-691ccc79df0b.png#averageHue=%23f3f3f3&clientId=u743e5c96-78a8-4&from=paste&height=205&id=u2a6f4fb9&originHeight=256&originWidth=993&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=107859&status=done&style=none&taskId=u20526ca2-60ce-44af-8dc5-32db6eb3c9f&title=&width=794.4" alt="image.png"><br>.&#x2F;configure –with-stream<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637420373-ea79556e-1193-4b1e-b5a0-067a534edb4e.png#averageHue=%23f7f6f6&clientId=u743e5c96-78a8-4&from=paste&height=271&id=ua1f7f6a4&originHeight=339&originWidth=852&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=154425&status=done&style=none&taskId=u819d23de-6483-43b8-9ecb-ca467681115&title=&width=681.6" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637588301-2a87d0fe-60d6-4ad4-9276-b9361bf3cb6a.png#averageHue=%23f4f4f3&clientId=u743e5c96-78a8-4&from=paste&height=420&id=u9ae89fd4&originHeight=525&originWidth=886&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=163738&status=done&style=none&taskId=u0c509ba8-7481-4823-909b-13a75f6fef4&title=&width=708.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684637629035-203bab7a-bb9b-4178-90c8-2565e35bacb0.png#averageHue=%23f7f6f6&clientId=u743e5c96-78a8-4&from=paste&height=69&id=u676ebad1&originHeight=86&originWidth=402&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=16792&status=done&style=none&taskId=u7a5b492b-faa4-48b4-b9c7-c18f17b9abe&title=&width=321.6" alt="image.png"></p>
<h3 id="6-redis"><a href="#6-redis" class="headerlink" title="6.redis"></a>6.redis</h3><p>subscribe阻塞<br>通道有消息，redis会主动推送给服务器<br>publish消息，<br>接收：服务器注册向redis注册回调</p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1684638782125-51891c0b-5a11-4470-bc91-50714a87188b.png#averageHue=%23f9f9f8&clientId=u743e5c96-78a8-4&from=paste&height=474&id=u20e66bac&originHeight=592&originWidth=953&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=321256&status=done&style=none&taskId=u23aeb4b1-9165-41fb-896f-7c70a75321d&title=&width=762.4" alt="image.png"></p>
<h2 id="网络io模型："><a href="#网络io模型：" class="headerlink" title="网络io模型："></a>网络io模型：</h2><p>muduo epoll加线程池<br>one loop per thread<br>客户端发送之后，等待通知登录是否成功，用到了信号量(semaphore)，共享登录状态量（atomic)，</p>
<h2 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h2><p>对称加密<br>非对称加密<br>服务端通过rsa公钥加密aes密钥<br>客户端用rsa私钥解密出aes<br>对消息解密</p>
<h2 id="历史消息存储"><a href="#历史消息存储" class="headerlink" title="历史消息存储"></a>历史消息存储</h2><p>本地消息存储<br>好友的qq号作为文件夹 或者sqlite嵌入式数据库， 以qq号作为字段存储到表中<br>云消息存储<br>mysql    半年以上 dump&#x3D;&#x3D;&gt; fileserver</p>
<h2 id="客户端消息如何按顺序显示"><a href="#客户端消息如何按顺序显示" class="headerlink" title="客户端消息如何按顺序显示"></a>客户端消息如何按顺序显示</h2><p>消息添加序号  seq</p>
<h2 id="？怎么保证消息的可靠传输"><a href="#？怎么保证消息的可靠传输" class="headerlink" title="？怎么保证消息的可靠传输"></a>？怎么保证消息的可靠传输</h2><p>业务层实现消息确认机制 心跳包机制确定服务器状态<br>为什么tcp消息确认机制不能保证消息可靠传输</p>
<h2 id="为什么引入负载均衡"><a href="#为什么引入负载均衡" class="headerlink" title="为什么引入负载均衡"></a>为什么引入负载均衡</h2><p><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/0d5386868af29dfd7e98da841#:~:text=%E6%89%80%E8%B0%93%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%EF%BC%8C%E5%B0%B1%E6%98%AF%20Nginx%20%E6%8A%8A%E8%AF%B7%E6%B1%82%E5%9D%87%E5%8C%80%E7%9A%84%E5%88%86%E6%91%8A%E7%BB%99%E4%B8%8A%E6%B8%B8%E7%9A%84%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%8D%B3%E4%BD%BF%E6%9F%90%E4%B8%80%E4%B8%AA%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%95%E6%9C%BA%E4%B9%9F%E4%B8%8D%E4%BC%9A%E5%BD%B1%E5%93%8D%E8%AF%B7%E6%B1%82%E7%9A%84%E5%A4%84%E7%90%86%EF%BC%8C%E6%88%96%E8%80%85%E5%BD%93%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%89%9B%E4%B8%8D%E4%BD%8F%E4%BA%86%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%9A%8F%E6%97%B6%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9%E3%80%82%20%E5%9C%A8%20x%20%E8%BD%B4%E4%B8%8A%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E6%A8%AA%E5%90%91%E6%89%A9%E5%B1%95%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%EF%BC%8CNginx,%E5%9F%BA%E4%BA%8E%20Round-Robin%20%E6%88%96%E8%80%85%20Least-Connected%20%E7%AE%97%E6%B3%95%E5%88%86%E5%8F%91%E8%AF%B7%E6%B1%82%E3%80%82%20%E4%BD%86%E6%98%AF%E6%A8%AA%E5%90%91%E6%89%A9%E5%B1%95%E5%B9%B6%E4%B8%8D%E8%83%BD%E8%A7%A3%E5%86%B3%E6%89%80%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E5%BD%93%E6%95%B0%E6%8D%AE%E9%87%8F%E5%A4%A7%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E6%97%A0%E8%AE%BA%E6%89%A9%E5%B1%95%E5%A4%9A%E5%B0%91%E5%8F%B0%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%8D%95%E5%8F%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%95%B0%E6%8D%AE%E9%87%8F%E4%BE%9D%E7%84%B6%E5%BE%88%E5%A4%A7%E3%80%82">nginx原理</a><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1667996304136-352828f8-479b-4690-9b9f-0f85fe4180d6.png#averageHue=%23bdc0c3&clientId=u6afd4a54-5dab-4&from=paste&height=550&id=GH6tm&originHeight=550&originWidth=548&originalType=binary&ratio=1&rotation=0&showTitle=false&size=241673&status=done&style=none&taskId=u8d633258-d068-49d9-abe7-04039c42850&title=&width=548" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1667996561858-f8940407-b1e4-4745-9759-3c0c472a099d.png#averageHue=%23cad0d4&clientId=u6afd4a54-5dab-4&from=paste&height=85&id=L6sh8&originHeight=85&originWidth=455&originalType=binary&ratio=1&rotation=0&showTitle=false&size=25806&status=done&style=none&taskId=uc95f7fe2-2450-4b4d-94b1-30fd6c8a11c&title=&width=455" alt="image.png"><br>1.单台服务器的并发量由于文件描述符有限，只能达到2万左右的同时聊天<br>引入负载均衡模块能够提供并发量  5w   <a target="_blank" rel="noopener" href="https://blog.csdn.net/apple9005/article/details/79961391">轮询，哈希，权重</a><br>进一步提高并发量 一台<a target="_blank" rel="noopener" href="https://juejin.cn/post/6966411996589719583">lvs</a>带多台nginx<br>客户端的请求和服务端的响应都通过niginx负载均衡器<br>⒉.能够和ChatServer保持心跳机制，监测ChatServer故障<br>3.能够发现新添加的ChatServer设备，方便扩展服务器数最<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1680395994049-85c46c28-f373-4833-ad04-6832d4afcc03.png#averageHue=%23fbfbfb&clientId=u00fc456d-cdce-4&from=paste&height=471&id=zxvrR&originHeight=589&originWidth=1050&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=225190&status=done&style=none&taskId=ua2e124ab-b20e-4007-8f38-22d07824359&title=&width=840" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1680396329618-85fa5113-eb3d-46c1-b165-b43f99e7388f.png#averageHue=%23e6e6e4&clientId=u00fc456d-cdce-4&from=paste&height=48&id=AMo8a&originHeight=60&originWidth=364&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=22362&status=done&style=none&taskId=u1cb358cd-e9ce-4331-959e-6b37f82a47a&title=&width=291.2" alt="image.png"></p>
<h2 id="正向代理反向代理"><a href="#正向代理反向代理" class="headerlink" title="正向代理反向代理"></a>正向代理反向代理</h2><p>简单来说，正向代理是代理客户端（即用户）访问外网，而反向代理是代理服务器（即网络设备）响应客户端的请求。具体区别如下：</p>
<ol>
<li>正向代理是为了隐藏客户端身份，反向代理是为了隐藏服务器身份；</li>
<li>客户端访问正向代理需要明确指定代理服务器，而反向代理是透明的，客户端无需知道实际提供服务的服务器；</li>
<li>正向代理主要用于翻墙、访问内网等，反向代理主要用于负载均衡、缓存、安全防护等。</li>
</ol>
<h2 id="为什么各个server不能相互直接通信，为什么用redis作为跨服务器通信组件"><a href="#为什么各个server不能相互直接通信，为什么用redis作为跨服务器通信组件" class="headerlink" title="为什么各个server不能相互直接通信，为什么用redis作为跨服务器通信组件"></a>为什么各个server不能相互直接通信，为什么用redis作为跨服务器通信组件</h2><p>服务器之间耦合程度大，通信消耗太大，不利于新增，用消息队列来解耦</p>
<h2 id="除了redis还有其他组件可以完成同样功能吗"><a href="#除了redis还有其他组件可以完成同样功能吗" class="headerlink" title="除了redis还有其他组件可以完成同样功能吗"></a>除了redis还有其他组件可以完成同样功能吗</h2><p>redis 缓存数据库key-value      数据持久化<br>redis：分布式锁   发布订阅功能<br>内存访问快，低延时<br>服务器中间件 ：  MQ消息队列<br>kafka（稳定，高并发，高可用）  zeromq   rabbitmq  rocketmq</p>
<p>redis运行不稳定，挂了怎么办，设计阈值，<br>没做消息可靠传输，没有应答，可能会被丢掉，redis发布的时候没人订阅 消息就丢了</p>
<h2 id="网络拥塞严重，Chatserver如何感知客户端在线还是掉线了"><a href="#网络拥塞严重，Chatserver如何感知客户端在线还是掉线了" class="headerlink" title="网络拥塞严重，Chatserver如何感知客户端在线还是掉线了"></a>网络拥塞严重，Chatserver如何感知客户端在线还是掉线了</h2><p>基于长连接的业务，心跳保持机制<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1668000906829-3c786d16-4633-4a1f-8c9c-91f3473a0623.png#averageHue=%23c3c4c7&clientId=u37ea39a8-4d6a-4&from=paste&height=259&id=oPuIB&originHeight=598&originWidth=1459&originalType=binary&ratio=1&rotation=0&showTitle=false&size=405649&status=done&style=none&taskId=u74d334cc-f7a6-4991-94b0-a292b5cba91&title=&width=633" alt="image.png"><br>TCP  keepalive功能  保活功能  默认关闭 （传输层）<br>listen socket<br>setsockopt SO_KEEPALIVE<br><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1668001095741-b31a2292-7f1d-44a4-a158-72bd026a816a.png#averageHue=%23cdcfd1&clientId=u37ea39a8-4d6a-4&from=paste&height=390&id=t3qes&originHeight=390&originWidth=1219&originalType=binary&ratio=1&rotation=0&showTitle=false&size=275792&status=done&style=none&taskId=ueeff9235-ca07-495b-81ad-f368875aae1&title=&width=1219" alt="image.png"><br>只关闭了socket fd<br>假如应用层死锁，传输层心跳包检测不出来。</p>
<p>json的序列化，反序列化：<br>muduo使用： libpthread  libmuduo_base libmuduo_net    -lmuduo_net -lmuduobase -lpthreadd<br>提供  tcpserver  tcpclient 两个类<br>实现了epoll + 线程池       用连接和断开   读写事件的发生都由网络库封装 能够把网络io和业务代码分开</p>
<h2 id="json序列化与反序列化实现原理是什么"><a href="#json序列化与反序列化实现原理是什么" class="headerlink" title="json序列化与反序列化实现原理是什么"></a>json序列化与反序列化实现原理是什么</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666087053089-7cefa996-2bae-4c13-8987-668a4c24b3ae.png#averageHue=%23fbfafc&clientId=u774e3d07-be0d-4&from=paste&height=108&id=duUPg&originHeight=108&originWidth=779&originalType=binary&ratio=1&rotation=0&showTitle=false&size=43807&status=done&style=none&taskId=uf667223c-0648-479d-94a1-d855d490da1&title=&width=779" alt="image.png"></p>
<h2 id="muduo库"><a href="#muduo库" class="headerlink" title="muduo库"></a>muduo库</h2><p><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666087136239-7b351363-f842-4aa0-a73e-2394dc534544.png#averageHue=%23edeeef&clientId=u774e3d07-be0d-4&from=paste&height=604&id=AQVij&originHeight=604&originWidth=1304&originalType=binary&ratio=1&rotation=0&showTitle=false&size=218044&status=done&style=none&taskId=u3b82d516-0abd-4d33-bd0b-f1a39b182ca&title=&width=1304" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666087754946-90d3c76c-3949-45a4-9f3b-7b66b72ee203.png#averageHue=%23d1e3d8&clientId=u774e3d07-be0d-4&from=paste&height=126&id=kPByl&originHeight=126&originWidth=712&originalType=binary&ratio=1&rotation=0&showTitle=false&size=85841&status=done&style=none&taskId=ua411e92b-44ea-4fa5-9a2a-72ebaa660b9&title=&width=712" alt="image.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1666094132325-973d6231-bf08-4643-93ec-09eb303e3bd1.png#averageHue=%23c2c1ce&clientId=u774e3d07-be0d-4&from=paste&height=415&id=GvNGl&originHeight=415&originWidth=1009&originalType=binary&ratio=1&rotation=0&showTitle=false&size=235875&status=done&style=none&taskId=u10794402-18ac-4e7c-b248-bdc4c86fa44&title=&width=1009" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2022/png/29443453/1667213649146-002406e4-d67b-4ad3-852e-54a61ca65767.png#averageHue=%23c8c7cb&clientId=u650d49d6-870b-4&from=paste&height=893&id=BeT56&originHeight=893&originWidth=944&originalType=binary&ratio=1&rotation=0&showTitle=false&size=452212&status=done&style=none&taskId=u4b8f1fa2-0d09-42bd-b2eb-c41b0152e5e&title=&width=944" alt="image.png"></p>
<h2 id="并发量"><a href="#并发量" class="headerlink" title="并发量"></a>并发量</h2><p>只能达到2万左右的同时聊天<br>引入负载均衡模块能够提供并发量  5w </p>
<h2 id="遇到的问题："><a href="#遇到的问题：" class="headerlink" title="遇到的问题："></a>遇到的问题：</h2><p>可以看到两个线程都阻塞到,主线程send之后  子线程没有注销，子线程在recv 主线程也在recv<br>客户端偶尔出现登录以后没有响应，造成业务不能继续进行，此时直接调试出现问题的服务器Server.out<br>解决：<br>ps -ef |grep Server 找到对应的服务器进程<br>gdb调试对应的进程<br>info threads找到对应的线程<br>但是（事件循环里的三个线程里的）ChatServer0却阻塞在__libc_recv函数处，不能继续处理逻辑业务，不能给客户端回复响应，导致客户端无应答。<br>打印堆栈信息<br>从上面的ChatServer0线程的调用堆栈打印信息（bt命令）可以看到，这个线程在处理客户端的登录请求时，需要向redis中间件消息队列订阅消息，是通过hiredis的redisCommand发送的subscribe订阅命令，但是通过调用堆栈信息查看，redisCommand不仅可以发送subscribe订阅命令到redis server，还会以阻塞的方式等待redis server的响应。<br>由于线程池里面的redisGetReply抢了上面订阅subscribe的redisCommand底层调用的redisGetReply的响应消息，导致ChatServer0线程阻塞在这个接口调用上，无法再次回到epoll_wait处了，这个线程就废掉了，如果工作线程全部发生这种情况，最终服务器所有的工作线程就全部停止工作了！<br>解决：<br>因此subcribe订阅消息只做消息发送，不做消息接收就可以了.代码如下：</p>
<p>客户端登录成功后启动子线程，进入main menu,循环接收， 主线程退出后，子线程没有退出<br>再次登录主线程send后，返回的响应被子线程接收了，导致主线程recv阻塞，子线程循环里recv没有处理逻辑也阻塞了<br>是gdb attach 客户端pid，<br>info threads查看连个线程<br>bt查看调用堆栈<br>解决：<br>主线程只发，子线程只读<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1680537354689-a36c34ee-81f6-4e29-bc29-76d4f2e2c292.png#averageHue=%23f9f8f8&clientId=u1a441170-8b1c-4&from=paste&height=506&id=fMGqs&originHeight=632&originWidth=992&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=192746&status=done&style=none&taskId=u31d66448-421d-45d7-a6bb-1bf805f4de6&title=&width=793.6" alt="image.png"><br>连接后启动子线程负责读，<br>主send后等待子线程的信号量来判断是否登录成功<br>由于c++11 只互斥锁和条件变量，<br>使用linux pthread库semaphore<br>（问题：<br>注销后再登录就卡死了<br>解决：<br>gdb attatch<br>info threads<br>bt<br>thread 2<br>bt）</p>
<h1 id="线程池项目"><a href="#线程池项目" class="headerlink" title="线程池项目"></a>线程池项目</h1><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097651849-2922dffc-c933-49b9-a491-8b51f43dfd0f.png#averageHue=%23efefef&clientId=u4da48238-fa3e-4&from=paste&height=83&id=uecfbd4f7&originHeight=104&originWidth=1283&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=99626&status=done&style=none&taskId=u4f9c9989-be4a-4019-8218-64029530c66&title=&width=1026.4" alt="image.png"><br>有哪些开源的线程池实现？跟它们的区别是什么？为什么要造轮子？<br>用到的技术：packaged_task   future  可变参模板  </p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097635561-fd67a721-7069-4de2-b0f2-62bda97d47f7.png#averageHue=%23f0f0f0&clientId=u4da48238-fa3e-4&from=paste&height=148&id=u5ae0781e&originHeight=185&originWidth=353&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=27986&status=done&style=none&taskId=u981c98d5-df48-4e26-8778-a22442d117f&title=&width=282.4" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097686742-94628300-2327-47cb-8eb8-3b2ce903bf5f.png#averageHue=%23efefef&clientId=u4da48238-fa3e-4&from=paste&height=268&id=u2e077a3b&originHeight=335&originWidth=867&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=140539&status=done&style=none&taskId=u6024ec15-66d3-4da3-8bdb-b1f1424fab9&title=&width=693.6" alt="image.png"></p>
<p>自己写的吗<br>遇到什么问题</p>
<p>项目名称:基于可变参模板实现的线程池git地址: <a href="mailto:&#103;&#105;&#116;&#x40;&#x67;&#x69;&#x74;&#x65;&#x65;&#x2e;&#99;&#111;&#x6d;">&#103;&#105;&#116;&#x40;&#x67;&#x69;&#x74;&#x65;&#x65;&#x2e;&#99;&#111;&#x6d;</a>:xxx&#x2F;xxx.git<br>平台工具: vs2019开发，centos7编译so库，gdb调试分析定位死锁问题项目描述:<br>1、基于可变参模板编程和引用折叠原理，实现线程池submitTask接口，支持任意任务函数和任意参数的传递<br>2、使用future类型定制submitTask提交任务的返回值<br>3、使用map和queue容器管理线程对象和任务<br>4、基于条件变量condition_variable和互斥锁mutex实现任务提交线程和任务执行线程间的通信机制<br>5、支持fixed和cached模式的线程池定制<br>6、xXXxx《自由发挥)<br>项目问题:<br>1、在ThreadPool的资源回收，等待线程池所有线程退出时，发生死锁问题，导致进程无法退出<br>2、在windows平台下运行良好的线程池，在linux平台下运行发生死锁问题，平台运行结果有差异化<br>分析定位问题:<br>主要通过gdb attach到正在运行的进程，通过info threads， thread tid，bt等命令查看各个线程的调用堆栈信息，结合项目代码，定位到发生死锁的代码片段，分析死锁问题发生的原因，xXxx，以及最终的解决方案。</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>实现成动态库的方式 输出接口文档<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681097885092-7c94bc56-8a51-482b-8845-efbabef7538e.png#averageHue=%23f6f5f5&clientId=u4da48238-fa3e-4&from=paste&height=558&id=u1c45ddc9&originHeight=698&originWidth=1501&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=354888&status=done&style=none&taskId=ua9041be0-11ef-49db-943a-afa383ae4bd&title=&width=1200.8" alt="image.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681098102032-a344042a-dfa1-4d7e-b593-3dc94cbb5219.png#averageHue=%23fefcfa&clientId=u4da48238-fa3e-4&from=paste&height=414&id=uac273fde&originHeight=517&originWidth=756&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=149425&status=done&style=none&taskId=u22309f7f-936f-41e2-bd58-aab3ccd5f54&title=&width=604.8" alt="image.png"><br>容器容纳抽象出来的线程类，   定义一个阈值<br>cached     fixed<br>             线程多：占用空间   切换开销大 惊群<br>容器容纳抽象出来的任务（多态思想，用户任务从提供的基类继承，将run方法重写） 需要考虑线程安全问题 线程取任务  和 submittask添加任务（可能返回添加失败），定义一个数量阈值<br>互斥锁，条件变量，完成互斥同步</p>
<h3 id="线程创建思路-submit-task"><a href="#线程创建思路-submit-task" class="headerlink" title="线程创建思路(submit_task)"></a>线程创建思路(submit_task)</h3><p>等待一秒内 任务队列不满（notfull或者taskque.size()&lt;maxquesize)<br>则继续<br>否则<br>插入任务失败返回空Result<br>将任务shared_ptr插入任务队列，通知所有消费者<br>根据模式和任务数量以及空闲线程数量判断是否创建线程，<br>是就创建unique_ptr传入线程map,并start该线程</p>
<h3 id="线程回收思路（threadfunc"><a href="#线程回收思路（threadfunc" class="headerlink" title="线程回收思路（threadfunc)"></a>线程回收思路（threadfunc)</h3><p>for循环<br>       获取锁<br> 任务队列如果为空<br>  线程池没运行了<br>就从map删除当前线程，并且通知exitcond<br>     如果是cached模式<br>线程空闲超一定时间就释放<br>        cached模式就等 not_empty<br>从任务队列取task<br>释放锁<br>如果还有其他任务，通知not_empty<br>通知not_full还可以提交任务<br>当前线程执行该task	  task-&gt;exec()<br>更新执行完任务的时间</p>
<h2 id="多线程程序一定好吗"><a href="#多线程程序一定好吗" class="headerlink" title="多线程程序一定好吗"></a>多线程程序一定好吗</h2><p>看具体的应用场景<br>io密集型还是cpu密集型<br>cpu密集：程序里的指令都是在做计算<br>io密集型：程序里的指令涉及一些io操作，比如设备  文件 网络操作（等待客户端连接 io操作是可以把进程阻塞住的，如果这时分配cpu，cpu就空闲下来了）<br>对于多核，io密集型 cpu密集型都可以<br>单核情况下，cpu密集型不适合多线程 因为有上下文切换的开销大，（怎么切换的  现场保持在线程栈（cpu寄存器值到内核栈中）<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681559706051-aa278808-9021-4d0a-b913-566350fb9ce3.png#averageHue=%23f1f1f1&clientId=u91a51984-9120-4&from=paste&height=172&id=ubb1f9517&originHeight=215&originWidth=755&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=97276&status=done&style=none&taskId=u29d22332-2d6e-4ce5-8e4d-51d2a1b514e&title=&width=604" alt="image.png"><br>pthread__creat()<br>涉及到用户空间和内核空间切换<br>pcb 内核栈（task_struct)     页目录页表 地址空间相应数据结构<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681559852030-37307770-622f-4f60-82ef-1c83e2bca8f2.png#averageHue=%23fdfaf9&clientId=u91a51984-9120-4&from=paste&height=358&id=u8579d2ae&originHeight=447&originWidth=934&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=200279&status=done&style=none&taskId=u865d38b8-2e4c-4761-b7aa-bbb5deb23bd&title=&width=747.2" alt="image.png"><br>所以不宜在服务执行过程中创建和销毁</p>
<h2 id="怎么确定线程数量"><a href="#怎么确定线程数量" class="headerlink" title="怎么确定线程数量"></a>怎么确定线程数量</h2><p>ulimit -a能看到 8M   32位3G的用户空间  能创建380个左右线程<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681559706051-aa278808-9021-4d0a-b913-566350fb9ce3.png#averageHue=%23f1f1f1&clientId=u91a51984-9120-4&from=paste&height=172&id=AD822&originHeight=215&originWidth=755&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=97276&status=done&style=none&taskId=u29d22332-2d6e-4ce5-8e4d-51d2a1b514e&title=&width=604" alt="image.png"><br>c++ muduo libevent<br>java netty mina<br>都是io复用+ 多线程<br>一般是按照cpu核心数量来定，扯到redis<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681600904035-4f764e43-63ce-4347-b676-83072035c8c2.png#averageHue=%23f4f4f3&clientId=u0bde6753-97ab-4&from=paste&height=413&id=u0a9c380a&originHeight=516&originWidth=1301&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=432864&status=done&style=none&taskId=ue61555bf-7aab-4023-a341-dd2550f4c55&title=&width=1040.8" alt="image.png"></p>
<h2 id="线程之间怎么通信"><a href="#线程之间怎么通信" class="headerlink" title="线程之间怎么通信"></a>线程之间怎么通信</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681601196539-8285e516-c4bc-4126-bf4c-076ec3eea316.png#averageHue=%23f6f6f6&clientId=u246fa6d8-4e1a-4&from=paste&height=246&id=qR0AW&originHeight=307&originWidth=376&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=49656&status=done&style=none&taskId=u53a41dc0-d33b-435a-9722-70fef626286&title=&width=300.8" alt="image.png"></p>
<h3 id="线程互斥"><a href="#线程互斥" class="headerlink" title="线程互斥"></a>线程互斥</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681601747146-33ff2638-fa09-4c5d-b526-9cd765800681.png#averageHue=%23fcf8f8&clientId=u246fa6d8-4e1a-4&from=paste&height=223&id=u33d24ffa&originHeight=279&originWidth=744&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=90496&status=done&style=none&taskId=u1514bf98-9951-4f59-a426-58897884e15&title=&width=595.2" alt="image.png"><br>线程之间顺序是不确定的<br>多线程环境下如果不存在竞态条件，线程是可重入的<br>存在竞态条件（临界区），不可重入（用互斥锁，自旋锁）</p>
<p>lock_guard 构造时加锁，析构时解锁<br>unique_guard提供手动的lock和unlock，跟条件变量一起使用<br>cas引出 aba问题 态 版本号</p>
<h3 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h3><p>mtx<br>condiv </p>
<h2 id="怎么设计run函数返回值，可以表示任意类型"><a href="#怎么设计run函数返回值，可以表示任意类型" class="headerlink" title="怎么设计run函数返回值，可以表示任意类型"></a>怎么设计run函数返回值，可以表示任意类型</h2><p>虚函数和模板为什么不能同时出现<br>虚函数和模板不能同时出现是因为模板需要在编译时进行实例化，而虚函数是在运行时才能确定调用哪个函数。因此，如果在一个模板类中定义了虚函数，编译器无法确定应该实例化哪个函数，因为不同的实例化可能会有不同的虚函数实现。</p>
<p>java和python有一个object对象，是所有对象的基类<br>c++17有Any<br>但可以用c++11来实现any接收任何其他对象</p>
<p>设计一个any类型 应该是一个基类指针<br>用模板定义一个类型的data并作为派生类的数据，<br>传给<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681288922419-40e9f437-363e-4c73-bc4b-cd2009e4f069.png#averageHue=%23f2efec&clientId=u01941d70-3b3c-4&from=paste&height=267&id=u32a88770&originHeight=334&originWidth=652&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=130830&status=done&style=none&taskId=ud32ad7c6-e9f2-4850-8504-4d599c9e57b&title=&width=521.6" alt="image.png"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Any</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Any</span>()= <span class="keyword">default</span>;</span><br><span class="line">    ~<span class="built_in">Any</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="built_in">Any</span>(<span class="type">const</span> Any&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    <span class="built_in">Any</span>(Any&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    Any&amp; <span class="keyword">operator</span> = (Any&amp;&amp;) = <span class="keyword">default</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//该构造函数可以让Any类型接收任意其他的数据</span></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="title">Any</span><span class="params">(T data)</span>:base_(std::make_unique&lt;Derive&lt;T&gt;&gt;(data))&#123;</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    T <span class="title">cast_</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//我们怎么从base_找到它所指向的Derive对象，从它里面取出data成员变量</span></span><br><span class="line">        <span class="comment">//基类指针-》派生类指针 RTTI</span></span><br><span class="line">        Derive&lt;T&gt; *pd = <span class="keyword">dynamic_cast</span>&lt;Derive&lt;T&gt;*&gt;(base_.<span class="built_in">get</span>());</span><br><span class="line">        <span class="keyword">if</span>(pd == <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="string">&quot;type unmatch&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pd-&gt;data_;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//基类类型</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Base</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">virtual</span> ~<span class="built_in">Base</span>() = <span class="keyword">default</span>; </span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//派生类类型</span></span><br><span class="line">    <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; </span><br><span class="line">    <span class="keyword">class</span>  <span class="title class_">Derive</span>: <span class="keyword">public</span> Base</span><br><span class="line">    &#123;        </span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">         <span class="built_in">Derive</span>(T data): <span class="built_in">data_</span>(data)&#123;&#125;;</span><br><span class="line">         T data_;</span><br><span class="line">         ~<span class="built_in">Derive</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//定义一个基类的指针</span></span><br><span class="line">    std::unique_ptr&lt;Base&gt; base_;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="如何设计Result机制，接收任务返回结果，res-get应该阻塞用户"><a href="#如何设计Result机制，接收任务返回结果，res-get应该阻塞用户" class="headerlink" title="如何设计Result机制，接收任务返回结果，res.get应该阻塞用户"></a>如何设计Result机制，接收任务返回结果，res.get应该阻塞用户</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Result</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Result</span>(std::shared_ptr&lt;Task&gt; task, <span class="type">bool</span> isvalid = <span class="literal">true</span>);</span><br><span class="line">    ~<span class="built_in">Result</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//问题1：setval方法，获取任务执行完的返回值</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setVal</span><span class="params">(Any any)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//问题2：get方法，用户调用这个方法获取task的返回值</span></span><br><span class="line">    <span class="function">Any <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Any any_; <span class="comment">//存储任务返回值</span></span><br><span class="line">    Semaphore sem_; <span class="comment">//线程通信的信号量(与任务执行线程通信)</span></span><br><span class="line">    std::shared_ptr&lt;Task&gt; task_; <span class="comment">//指向对应获取返回值的任务对象</span></span><br><span class="line">    std::atomic_bool isvalid_;  <span class="comment">//返回值是否有效</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>c++20提供了semaphore<br>自己实现： 互斥锁+条件变量<br>线程互斥： mutez  atomic<br>通信： 条件变量 信号量</p>
<p>master-slave<br>master分解任务然后给各个slave线程分配任务<br>等待各个slave线程执行完任务，返回结果<br>master线程合并各个任务结果</p>
<h2 id="提交任务优化"><a href="#提交任务优化" class="headerlink" title="提交任务优化"></a>提交任务优化</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681611763077-3f64a0ea-c82e-48e5-8c45-d8ee5c3b3293.png#averageHue=%23273623&clientId=u246fa6d8-4e1a-4&from=paste&height=129&id=ue4e9217b&originHeight=161&originWidth=579&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=110291&status=done&style=none&taskId=u13d14352-a72c-4439-ad91-7f0f6cdd813&title=&width=463.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681611927195-ae2feb8f-58b3-4f18-ae42-9f730249a314.png#averageHue=%2324291d&clientId=u246fa6d8-4e1a-4&from=paste&height=79&id=ubf990406&originHeight=99&originWidth=1003&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=88017&status=done&style=none&taskId=ud685380b-0e24-40e2-9a73-c7dca924580&title=&width=802.4" alt="image.png"><br>#include <future><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681612026587-b9d76479-9c49-4518-bcf8-1fec9ea05865.png#averageHue=%23312f28&clientId=u246fa6d8-4e1a-4&from=paste&height=422&id=u49f5e059&originHeight=528&originWidth=717&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=188098&status=done&style=none&taskId=ufbb39091-3497-4c80-adc4-5a67aec1d04&title=&width=573.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681612192601-4cdcd9ff-80f4-4211-9874-cb3799294b80.png#averageHue=%2331332a&clientId=u246fa6d8-4e1a-4&from=paste&height=241&id=u0a64c93a&originHeight=301&originWidth=665&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=153374&status=done&style=none&taskId=u111c1694-cc47-4a40-96c7-2f07a2892c4&title=&width=532" alt="image.png"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> Func, <span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">	<span class="keyword">auto</span> <span class="title">submitTask</span><span class="params">(Func&amp;&amp; func, Args&amp;&amp;... args)</span> -&gt; std::future&lt;<span class="title">decltype</span><span class="params">(func(args...))</span>&gt;</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 打包任务，放入任务队列里面</span></span><br><span class="line">		<span class="keyword">using</span> RType = <span class="keyword">decltype</span>(<span class="built_in">func</span>(args...));</span><br><span class="line">		<span class="keyword">auto</span> task = std::make_shared&lt;std::packaged_task&lt;<span class="built_in">RType</span>()&gt;&gt;(</span><br><span class="line">			std::<span class="built_in">bind</span>(std::forward&lt;Func&gt;(func), std::forward&lt;Args&gt;(args)...));</span><br><span class="line">		std::future&lt;RType&gt; result = task-&gt;<span class="built_in">get_future</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取锁</span></span><br><span class="line">		<span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(taskQueMtx_)</span></span>;</span><br><span class="line">		<span class="comment">// 用户提交任务，最长不能阻塞超过1s，否则判断提交任务失败，返回</span></span><br><span class="line">		<span class="keyword">if</span> (!notFull_.<span class="built_in">wait_for</span>(lock, std::chrono::<span class="built_in">seconds</span>(<span class="number">1</span>),</span><br><span class="line">			[&amp;]()-&gt;<span class="type">bool</span> &#123; <span class="keyword">return</span> taskQue_.<span class="built_in">size</span>() &lt; (<span class="type">size_t</span>)taskQueMaxThreshHold_; &#125;))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 表示notFull_等待1s种，条件依然没有满足</span></span><br><span class="line">			std::cerr &lt;&lt; <span class="string">&quot;task queue is full, submit task fail.&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">			<span class="keyword">auto</span> task = std::make_shared&lt;std::packaged_task&lt;<span class="built_in">RType</span>()&gt;&gt;(</span><br><span class="line">				[]()-&gt;RType &#123; <span class="keyword">return</span> <span class="built_in">RType</span>(); &#125;);</span><br><span class="line">			(*task)();</span><br><span class="line">			<span class="keyword">return</span> task-&gt;<span class="built_in">get_future</span>();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 如果有空余，把任务放入任务队列中</span></span><br><span class="line">		<span class="comment">// taskQue_.emplace(sp);  </span></span><br><span class="line">		<span class="comment">// using Task = std::function&lt;void()&gt;;</span></span><br><span class="line">		taskQue_.<span class="built_in">emplace</span>([task]() &#123;(*task)();&#125;);</span><br><span class="line">		taskSize_++;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 因为新放了任务，任务队列肯定不空了，在notEmpty_上进行通知，赶快分配线程执行任务</span></span><br><span class="line">		notEmpty_.<span class="built_in">notify_all</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// cached模式 任务处理比较紧急 场景：小而快的任务 需要根据任务数量和空闲线程的数量，判断是否需要创建新的线程出来</span></span><br><span class="line">		<span class="keyword">if</span> (poolMode_ == PoolMode::MODE_CACHED</span><br><span class="line">			&amp;&amp; taskSize_ &gt; idleThreadSize_</span><br><span class="line">			&amp;&amp; curThreadSize_ &lt; threadSizeThreshHold_)</span><br><span class="line">		&#123;</span><br><span class="line">			std::cout &lt;&lt; <span class="string">&quot;&gt;&gt;&gt; create new thread...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 创建新的线程对象</span></span><br><span class="line">			<span class="keyword">auto</span> ptr = std::<span class="built_in">make_unique</span>&lt;Thread&gt;(std::<span class="built_in">bind</span>(&amp;ThreadPool::threadFunc, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line">			<span class="type">int</span> threadId = ptr-&gt;<span class="built_in">getId</span>();</span><br><span class="line">			threads_.<span class="built_in">emplace</span>(threadId, std::<span class="built_in">move</span>(ptr));</span><br><span class="line">			<span class="comment">// 启动线程</span></span><br><span class="line">			threads_[threadId]-&gt;<span class="built_in">start</span>();</span><br><span class="line">			<span class="comment">// 修改线程个数相关的变量</span></span><br><span class="line">			curThreadSize_++;</span><br><span class="line">			idleThreadSize_++;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 返回任务的Result对象</span></span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 开启线程池</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">start</span><span class="params">(<span class="type">int</span> initThreadSize = std::thread::hardware_concurrency())</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 设置线程池的运行状态</span></span><br><span class="line">		isPoolRunning_ = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 记录初始线程个数</span></span><br><span class="line">		initThreadSize_ = initThreadSize;</span><br><span class="line">		curThreadSize_ = initThreadSize;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建线程对象</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; initThreadSize_; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 创建thread线程对象的时候，把线程函数给到thread线程对象</span></span><br><span class="line">			<span class="keyword">auto</span> ptr = std::<span class="built_in">make_unique</span>&lt;Thread&gt;(std::<span class="built_in">bind</span>(&amp;ThreadPool::threadFunc, <span class="keyword">this</span>, std::placeholders::_1));</span><br><span class="line">			<span class="type">int</span> threadId = ptr-&gt;<span class="built_in">getId</span>();</span><br><span class="line">			threads_.<span class="built_in">emplace</span>(threadId, std::<span class="built_in">move</span>(ptr));</span><br><span class="line">			<span class="comment">// threads_.emplace_back(std::move(ptr));</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 启动所有线程  std::vector&lt;Thread*&gt; threads_;</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; initThreadSize_; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			threads_[i]-&gt;<span class="built_in">start</span>(); <span class="comment">// 需要去执行一个线程函数</span></span><br><span class="line">			idleThreadSize_++;    <span class="comment">// 记录初始空闲线程的数量</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="代码量"><a href="#代码量" class="headerlink" title="代码量"></a>代码量</h2><p>530行<br>手写了any,semaphore<br>支持了fixed，cached模式<br>支持用户设置工作模式，任务队列上限阈值，线程数量上限阈值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现一个信号量类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Semaphore</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Semaphore</span>(<span class="type">int</span> limit = <span class="number">0</span>)</span><br><span class="line">        :<span class="built_in">resLimit_</span>(limit)&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Semaphore</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="comment">//获取一个信号量资源</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">wait</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        <span class="comment">//等待信号量有资源，没有的话阻塞当前线程</span></span><br><span class="line">        cond_.<span class="built_in">wait</span>(lock, [&amp;]()-&gt;<span class="type">bool</span>&#123;<span class="keyword">return</span> resLimit_&gt;<span class="number">0</span>;&#125;);</span><br><span class="line">        resLimit_--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//增加一个信号量资源</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">post</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        resLimit_++;</span><br><span class="line">        cond_.<span class="built_in">notify_all</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> resLimit_;</span><br><span class="line">    std::mutex mtx_;</span><br><span class="line">    std::condition_variable cond_;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="windows死锁"><a href="#windows死锁" class="headerlink" title="windows死锁"></a>windows死锁</h3><p>实现线程池核心功能的时候没有遇到太大问题，设计上遇到一些问题</p>
<p>在实现线程池资源回收的时候，在测试的时候发现一些死锁的情况<br>在linux （集群聊天服务器16节课， gdb把每个线程栈打印出来）<br>发现线程池在退出析构的时候会等待exitCond这个条件变量，意味着有线程没有被回收掉</p>
<p>非必现的问题，</p>
<p>线程析构和线程函数<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681467469722-43e8fe54-04ba-47cc-9d3e-f5e16cc4dcfe.png#averageHue=%23878480&clientId=ud78e10a6-887f-4&from=paste&height=630&id=u20ba9965&originHeight=787&originWidth=1515&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=705908&status=done&style=none&taskId=uab0babe6-92bb-4d55-82b8-54cb7f33c22&title=&width=1212" alt="image.png"><br>如果析构线程先获得锁，wait释放锁但是由于还有线程未执行完，所以在exitCond.wait阻塞，<br>threadfunc中的线程获得锁，进入notEmpty.wait，<br>由于任务队列为空且没有线程再notify，所以阻塞。</p>
<p>如果线程函数线程先获得锁，那么进入notempty.wait,  threadpool析构获得锁，阻塞到exitCond.wait</p>
<p>解决：1.调整notempty_notify的位置，<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681469423985-c5af2eb9-61fd-449f-98c6-2d2b0898798d.png#averageHue=%233b4336&clientId=u84c80d1a-d421-4&from=paste&height=261&id=u9823dab5&originHeight=326&originWidth=926&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=243533&status=done&style=none&taskId=u35073638-74e7-43fe-b570-5b9669bf38c&title=&width=740.8" alt="image.png"><br>2.<br>线程函数加双重判断<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681469460963-ff95181f-ce4a-4fb4-9286-b1f1390414a3.png#averageHue=%2321201f&clientId=u84c80d1a-d421-4&from=paste&height=60&id=u76eed82c&originHeight=75&originWidth=459&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=9020&status=done&style=none&taskId=u70909f67-799e-4b04-8a1d-3f5c38f327f&title=&width=367.2" alt="image.png"><br>如果线程池析构不会再进入notEmpty.wai()</p>
<h3 id="linux下死锁"><a href="#linux下死锁" class="headerlink" title="linux下死锁"></a>linux下死锁</h3><p>ps -u当前用户进程<br>gdb attach 6359<br>info theads<br>主线程bt<br>thread 5 切到线程5<br>发现 阻塞在semaphore的 post（）中的   cond_.notify_all()<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681551982504-3500d18c-d127-4b2e-acb6-36c3085b7a4d.png#averageHue=%23333028&clientId=uea553347-230e-4&from=paste&height=151&id=u5d163111&originHeight=189&originWidth=838&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=109510&status=done&style=none&taskId=ucc02137e-087f-4790-ba84-59da482c892&title=&width=670.4" alt="image.png"><br>主线程提交完任务 出了作用域 result对象也要析构 其中的semaphore也要析构<br>semaphore中的 mtx , condition_variable析构<br>所以post中的  cond_已经析构</p>
<p>windows下condition_variable析构的时候会释放资源，<br>find &#x2F; -name condition_variable 根目录下查看conditon_variable头文件<br>linux condition什么都没做，没有释放资源，导致状态失效，无故阻塞</p>
<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>生成动态库<br>g++-fPIC -shared threadpool.cpp -o libtdpool.so -std&#x3D;c++17<br>编译链接成可执行文件<br>g++线程池项目测试.cpp -std&#x3D;c++17 -ltdpool -lpthread<br>ld.so.cahe<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550753982-968910c9-a429-47ef-86b9-cddd7dc7be0a.png#averageHue=%23323b3e&clientId=uea553347-230e-4&from=paste&height=37&id=u8a199c9b&originHeight=46&originWidth=525&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=30969&status=done&style=none&taskId=u476b4cdc-f611-4ce6-97a8-29a0197f2af&title=&width=420" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550791890-63b48c55-7d0e-49e8-9236-d5d7fdc71755.png#averageHue=%232e363a&clientId=uea553347-230e-4&from=paste&height=30&id=u06a96bd0&originHeight=37&originWidth=196&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=6206&status=done&style=none&taskId=u51d7106b-13bc-4c0a-b0b1-27792a34022&title=&width=156.8" alt="image.png"><br>添加usr&#x2F;local&#x2F;lib到.conf<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550904337-16167249-a262-45e7-8f90-1758795c88f5.png#averageHue=%232f363a&clientId=uea553347-230e-4&from=paste&height=414&id=ue577903d&originHeight=517&originWidth=1193&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=484573&status=done&style=none&taskId=u9c28adf8-54c5-4718-b1dc-a4624ce7b90&title=&width=954.4" alt="image.png"><br><a target="_blank" rel="noopener" href="https://my.oschina.net/daquan/blog/488335">https://my.oschina.net/daquan/blog/488335</a><br> 刷新cache<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681550942858-018d786e-5399-4119-a9c6-707933f1c415.png#averageHue=%23323c3f&clientId=uea553347-230e-4&from=paste&height=133&id=u483e1a85&originHeight=166&originWidth=527&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=83836&status=done&style=none&taskId=u8bfb5da2-c9f1-4387-9d51-f415fb7ef62&title=&width=421.6" alt="image.png"></p>
<h1 id="实习经历"><a href="#实习经历" class="headerlink" title="实习经历"></a>实习经历</h1><p>所用技术：<br>shell,c&#x2F;c++, cmake,git，websocket，线程间通信<br>实习难点：出现反复创建图片后，系统内存多用2M的内存的情况，客户无法解决<br>实习成果：经过编写代码以及shell脚本监控内存使用情况，成功复现出问题，<br>发现是堆内存使用量升高。使用源码<br>个人收获：<br>了解了项目的开发流程<br>熟悉了常用工具的使用<br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263327874-2b3ef803-6699-4f03-b275-fa9031254cdb.png#averageHue=%23ece9e7&clientId=u725a01cb-e2b1-4&from=paste&height=129&id=uff42c514&originHeight=161&originWidth=882&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=36216&status=done&style=none&taskId=u3be6c792-6cd3-4f27-8bfb-93d6869b992&title=&width=705.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263641578-1f2f8cdb-7835-4dd7-bd39-67ab48bfe905.png#averageHue=%23f8f7f6&clientId=u725a01cb-e2b1-4&from=paste&height=240&id=u752034a1&originHeight=300&originWidth=964&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=145945&status=done&style=none&taskId=u4e74f7b7-7b25-424f-974f-e05d1cf8d5e&title=&width=771.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/29443453/1681263626853-cd89773c-c5cc-4d78-81ce-07ced18121c8.png#averageHue=%23f0f5e4&clientId=u725a01cb-e2b1-4&from=paste&height=303&id=u36759d41&originHeight=379&originWidth=893&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=76713&status=done&style=none&taskId=u00e81ab5-300d-4fc0-b928-da07dbcb09e&title=&width=714.4" alt="image.png"></p>
<h1 id="HR面问题"><a href="#HR面问题" class="headerlink" title="HR面问题"></a>HR面问题</h1><h2 id="平时学习有哪些途径和方法？"><a href="#平时学习有哪些途径和方法？" class="headerlink" title="平时学习有哪些途径和方法？"></a>平时学习有哪些途径和方法？</h2><h2 id="遇到问题时怎么想办法解决？"><a href="#遇到问题时怎么想办法解决？" class="headerlink" title="遇到问题时怎么想办法解决？"></a>遇到问题时怎么想办法解决？</h2><h2 id="自己做过最有成就感的事情是什么？"><a href="#自己做过最有成就感的事情是什么？" class="headerlink" title="自己做过最有成就感的事情是什么？"></a>自己做过最有成就感的事情是什么？</h2><h2 id="未来想做哪方面的工作？"><a href="#未来想做哪方面的工作？" class="headerlink" title="未来想做哪方面的工作？"></a>未来想做哪方面的工作？</h2><h2 id="我的问题完了，你有什么想问我的吗？"><a href="#我的问题完了，你有什么想问我的吗？" class="headerlink" title="我的问题完了，你有什么想问我的吗？"></a>我的问题完了，你有什么想问我的吗？</h2><h2 id="看过什么开源代码"><a href="#看过什么开源代码" class="headerlink" title="看过什么开源代码"></a>看过什么开源代码</h2><p>c++智能指针<br>nginx内存池<br>muduo网络库的源码</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/03/01/myself/" data-id="clid7yx130000lknja6dlh5gz" data-title="new test" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2023/06/01/hello-world/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Hello World
        
      </div>
    </a>
  
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">June 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/06/01/distributed-system/">distrubuted system</a>
          </li>
        
          <li>
            <a href="/2023/06/01/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2023/03/01/myself/">new test</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>